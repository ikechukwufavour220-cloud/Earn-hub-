<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Earn Hub</title>
<style>
  body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f5f5f5}
  .loading{display:flex;justify-content:center;align-items:center;height:100vh;font-size:24px}
  .hidden{display:none}
  header{background:#4CAF50;color:white;padding:15px;text-align:center;font-size:20px}
  nav{position:fixed;bottom:0;left:0;right:0;background:#fff;display:flex;justify-content:space-around;border-top:1px solid #ccc}
  nav button{flex:1;padding:10px;border:none;background:none;font-size:16px}
  .page{padding:20px;display:none}
  .active{display:block}
  .lock{opacity:0.5;pointer-events:none}
  .task,.ad{margin:10px 0;padding:10px;background:#fff;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
  input,button{padding:10px;margin:5px 0;width:100%}
  .admin-nav{display:flex;gap:10px;margin-bottom:10px}
  .admin-nav button{flex:1;padding:10px;border:none;background:#4CAF50;color:white}
</style>
</head>
<body>
<div id="loading" class="loading">Loading...</div>

<!-- Auth -->
<div id="auth" class="page">
<h2>Login / Signup</h2>
<input id="name" placeholder="Full Name">
<input id="email" placeholder="Email">
<input id="phone" placeholder="Phone">
<input id="password" type="password" placeholder="Password">
<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
</div>

<!-- User UI -->
<div id="userApp" class="hidden">
<header>Balance: ₦<span id="balance">0</span></header>
<div id="dashboard" class="page active">
<h3>Tasks & Ads</h3>
<div id="lockedMsg">Pay ₦200 to unlock tasks & ads</div>
<button onclick="payNow()">Pay ₦200</button>
<div id="tasks" class="hidden"></div>
<div id="ads" class="hidden"></div>
</div>
<div id="refer" class="page">
<h3>Refer & Earn</h3>
<p>Your referral link:</p>
<input id="refLink" readonly>
</div>
<div id="profile" class="page">
<h3>Profile</h3>
<p id="userInfo"></p>
<h4>Withdraw</h4>
<input id="withdrawAmt" placeholder="Amount">
<input id="bank" placeholder="Bank Account">
<button onclick="withdraw()">Request Withdraw</button>
</div>
<nav>
<button onclick="showPage('dashboard')">Dashboard</button>
<button onclick="showPage('refer')">Refer</button>
<button onclick="showPage('profile')">Profile</button>
</nav>
</div>

<!-- Admin UI -->
<div id="adminApp" class="hidden">
<header>Admin Panel</header>
<div class="admin-nav">
<button onclick="showAdmin('users')">Users</button>
<button onclick="showAdmin('tasks')">Tasks</button>
<button onclick="showAdmin('ads')">Ads</button>
<button onclick="showAdmin('withdraws')">Withdrawals</button>
</div>
<div id="adminUsers" class="page active"><h3>All Users</h3><div id="userList"></div></div>
<div id="adminTasks" class="page"><h3>Add Task</h3><input id="taskLink" placeholder="Task Link"><input id="taskReward" placeholder="Reward"><button onclick="addTask()">Add Task</button><div id="taskList"></div></div>
<div id="adminAds" class="page"><h3>Add Ad</h3><input id="adVideo" placeholder="Video URL"><input id="adLink" placeholder="Click URL"><button onclick="addAd()">Add Ad</button><div id="adList"></div></div>
<div id="adminWithdraws" class="page"><h3>Withdraw Requests</h3><div id="withdrawList"></div></div>

<!-- Firebase + Paystack -->
<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js"></script>
<script src="https://js.paystack.co/v1/inline.js"></script>
<script>
  const firebaseConfig={apiKey:"AIzaSyBydvDZETeZek37qoIpMlg3c6PLztPzRIg",authDomain:"earn-hub-bd942.firebaseapp.com",projectId:"earn-hub-bd942",storageBucket:"earn-hub-bd942.firebasestorage.app",messagingSenderId:"1018701515599",appId:"1:1018701515599:web:68a432d89b09a3cc23933a",measurementId:"G-W9QTS2C2FJ"};
  firebase.initializeApp(firebaseConfig);
  const db=firebase.firestore();

  let currentUser=null,referrer=new URLSearchParams(location.search).get("ref");

  function showPage(id){document.querySelectorAll("#userApp .page").forEach(p=>p.classList.remove("active"));document.getElementById(id).classList.add("active");}
  function showAdmin(id){document.querySelectorAll("#adminApp .page").forEach(p=>p.classList.remove("active"));document.getElementById("admin"+id.charAt(0).toUpperCase()+id.slice(1)).classList.add("active");}

  async function signup(){
    let name=document.getElementById("name").value,email=document.getElementById("email").value,phone=document.getElementById("phone").value,pass=document.getElementById("password").value;
    if(!name||!email||!pass) return alert("Fill all fields");
    await db.collection("users").doc(email).set({name,email,phone,pass,balance:0,paid:false,ref:referrer||null});
    alert("Signup done, now login");
  }

  async function login(){
    let email=document.getElementById("email").value,pass=document.getElementById("password").value;
    if((email==="ikechukwufavour220@gmail.com"&&pass==="Chiboy@2011")||(email==="samuelikechukwu260@gmail.com"&&pass==="Talented@47")){
      document.getElementById("auth").classList.add("hidden");document.getElementById("adminApp").classList.remove("hidden");loadAdmin();return;
    }
    let docSnap=await db.collection("users").doc(email).get();
    if(!docSnap.exists||docSnap.data().pass!==pass) return alert("Invalid login");
    currentUser=docSnap.data();
    document.getElementById("auth").classList.add("hidden");document.getElementById("userApp").classList.remove("hidden");
    loadUser();
  }

  function loadUser(){
    document.getElementById("balance").innerText=currentUser.balance;
    document.getElementById("userInfo").innerText=`${currentUser.name} (${currentUser.email})`;
    document.getElementById("refLink").value=location.origin+location.pathname+"?ref="+currentUser.email;
    if(currentUser.paid){unlock();}
  }

  function unlock(){
    document.getElementById("lockedMsg").classList.add("hidden");
    document.getElementById("tasks").classList.remove("hidden");
    document.getElementById("ads").classList.remove("hidden");
  }

  function payNow(){
    var handler=PaystackPop.setup({
      key:"pk_live_d52baea87b2c4e49b110aa5cda32260b33b0cb35",
      email:currentUser.email,
      amount:200*100,
      currency:"NGN",
      callback:async function(){
        await db.collection("users").doc(currentUser.email).update({paid:true});
        unlock();
        if(currentUser.ref){
          let refDoc=await db.collection("users").doc(currentUser.ref).get();
          if(refDoc.exists){
            let bal=refDoc.data().balance+50;
            await db.collection("users").doc(currentUser.ref).update({balance:bal});
          }
        }
        alert("Payment successful! Tasks unlocked.");
      }
    });
    handler.openIframe();
  }

  async function withdraw(){
    let amt=parseInt(document.getElementById("withdrawAmt").value),bank=document.getElementById("bank").value;
    if(amt<100) return alert("Minimum withdrawal is ₦100");
    await db.collection("withdrawals").add({user:currentUser.email,amt,bank,status:"pending"});
    alert("Withdraw request sent");
  }

  async function loadAdmin(){
    let snap=await db.collection("users").get();
    let html="";snap.for